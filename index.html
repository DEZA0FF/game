<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Telegram PvP Clicker</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  background: #0f0f0f;
  color: white;
  font-family: Arial;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}
.game { text-align: center; }
button {
  padding: 15px 30px;
  font-size: 20px;
  border-radius: 10px;
  border: none;
  margin: 10px;
}
</style>
</head>

<body>
<div class="game">
  <h2 id="mode">PvP —Ä–µ–∂–∏–º</h2>
  <p>–û—á–∫–∏: <span id="score">0</span></p>
  <p>–í—Ä–µ–º—è: <span id="time">20</span></p>

  <button id="click">–ñ–ú–ò</button>
  <button id="pvp">üéÆ –ò–≥—Ä–∞—Ç—å PvP</button>
</div>

<script>
const tg = Telegram.WebApp;
tg.expand();

let score = 0;
let time = 20;
let timer = null;
let matchId = null;
let playing = false;

const scoreEl = document.getElementById("score");
const timeEl = document.getElementById("time");

document.getElementById("pvp").onclick = () => {
  tg.sendData(JSON.stringify({
    action: "find_match"
  }));
  document.getElementById("mode").innerText = "‚è≥ –ü–æ–∏—Å–∫ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞...";
};

document.getElementById("click").onclick = () => {
  if (!playing) return;
  score++;
  scoreEl.innerText = score;
  tg.HapticFeedback?.impactOccurred("light");
};

tg.onEvent("message", (data) => {
  const msg = JSON.parse(data);
  if (msg.action === "start_match") {
    startGame(msg.match_id);
  }
});

function startGame(id) {
  matchId = id;
  score = 0;
  time = 20;
  playing = true;

  document.getElementById("mode").innerText = "‚öîÔ∏è PvP –º–∞—Ç—á!";
  scoreEl.innerText = score;
  timeEl.innerText = time;

  timer = setInterval(() => {
    time--;
    timeEl.innerText = time;
    if (time <= 0) endGame();
  }, 1000);
}

function endGame() {
  clearInterval(timer);
  playing = false;

  tg.sendData(JSON.stringify({
    action: "match_result",
    match_id: matchId,
    score: score
  }));

  document.getElementById("mode").innerText = "üì§ –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω";
}
</script>
</body>
</html>
